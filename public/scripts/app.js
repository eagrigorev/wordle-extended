import { KEYS, ROWS, WORDLE, field, keyboard } from './const.js';
import { keyboardColors } from './keyboardColors.js';
import { displayMessage } from './displayMessage.js';
let row = 0;
let tile = 0;
let gameOver = false;
ROWS.forEach((row, rowIndex) => {
    const rowElement = document.createElement('div');
    rowElement.setAttribute('id', `row-${rowIndex}`);
    row.forEach((tile, tileIndex) => {
        const tileElement = document.createElement('div');
        tileElement.setAttribute('id', `row-${rowIndex}-tile-${tileIndex}`);
        tileElement.classList.add('game-container__tile');
        rowElement.append(tileElement);
    });
    if (field != null) {
        field.append(rowElement);
    }
});
KEYS.forEach((key) => {
    const button = document.createElement('button');
    button.textContent = key;
    button.setAttribute('id', key);
    button.addEventListener('click', () => handleClick(key));
    if (keyboard != null) {
        keyboard.append(button);
    }
});
const handleClick = (key) => {
    if (!gameOver) {
        if (key === 'DELETE') {
            deleteLetter();
            return;
        }
        if (key === 'ENTER') {
            checkWordle();
            return;
        }
        addLetter(key);
    }
};
const addLetter = (key) => {
    if (row < 7 && tile < 6) {
        const currentTile = document.getElementById(`row-${row}-tile-${tile}`);
        if (currentTile != null) {
            currentTile.textContent = key;
            currentTile.setAttribute('data', key);
            ROWS[row][tile] = key;
            tile++;
            console.log(ROWS);
        }
    }
};
const deleteLetter = () => {
    if (tile > 0) {
        tile--;
        const currentTile = document.getElementById(`row-${row}-tile-${tile}`);
        if (currentTile != null) {
            currentTile.textContent = '';
            currentTile.setAttribute('data', '');
            ROWS[row][tile] = '';
        }
    }
};
const checkWordle = () => {
    if (tile > 5) {
        const userWordle = ROWS[row].join('');
        flipColorsAnimation();
        console.log(`User word is ${userWordle} and the correct word is ${WORDLE}`);
        if (userWordle === WORDLE) {
            displayMessage('Correct!');
            gameOver = true;
            return;
        }
        else {
            if (row >= 6) {
                displayMessage('Game Over');
                gameOver = true;
                return;
            }
            if (row < 6) {
                row++;
                tile = 0;
            }
        }
    }
};
const flipColorsAnimation = () => {
    const parentRow = document.querySelector(`#row-${row}`);
    let wordleCheck = WORDLE;
    const userWordle = [];
    if (parentRow != null) {
        const tiles = Object.values(parentRow.childNodes);
        tiles.forEach((tile, index) => {
            const tileData = tile.getAttribute('data');
            if (tileData != null) {
                userWordle.push({
                    key: tileData,
                    color: 'color_grey'
                });
                userWordle.forEach((letter, index) => {
                    if (letter.key == WORDLE[index]) {
                        letter.color = 'color_green';
                        wordleCheck = wordleCheck.replace(letter.key, '');
                    }
                });
                userWordle.forEach((letter) => {
                    if (wordleCheck.includes(letter.key)) {
                        letter.color = 'color_yellow';
                        wordleCheck = wordleCheck.replace(letter.key, '');
                    }
                });
                setTimeout(() => {
                    tile.classList.add('game-container__tile_flip-animation');
                    tile.classList.add(userWordle[index].color);
                    keyboardColors(userWordle[index].key, userWordle[index].color);
                }, 300 * index);
            }
        });
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2FwcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUVqRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXJELElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztBQUNaLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQztBQUNiLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQztBQUVyQixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBYSxFQUFFLFFBQWdCLEVBQUUsRUFBRTtJQUMvQyxNQUFNLFVBQVUsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2pELFVBQVUsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLE9BQU8sUUFBUSxFQUFFLENBQUMsQ0FBQztJQUNqRCxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBWSxFQUFFLFNBQWlCLEVBQUUsRUFBRTtRQUM5QyxNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xELFdBQVcsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLE9BQU8sUUFBUSxTQUFTLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFDcEUsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUNsRCxVQUFVLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2pDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsSUFBSSxLQUFLLElBQUksSUFBSSxFQUFFO1FBQ2pCLEtBQUssQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7S0FDMUI7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFXLEVBQUUsRUFBRTtJQUMzQixNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sQ0FBQyxXQUFXLEdBQUcsR0FBRyxDQUFDO0lBQ3pCLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQy9CLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsR0FBUyxFQUFFLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDL0QsSUFBSSxRQUFRLElBQUksSUFBSSxFQUFFO1FBQ3BCLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDekI7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sV0FBVyxHQUFHLENBQUMsR0FBVyxFQUFRLEVBQUU7SUFDeEMsSUFBSSxDQUFDLFFBQVEsRUFBRTtRQUNiLElBQUksR0FBRyxLQUFLLFFBQVEsRUFBRTtZQUNwQixZQUFZLEVBQUUsQ0FBQztZQUNmLE9BQU87U0FDUjtRQUNELElBQUksR0FBRyxLQUFLLE9BQU8sRUFBRTtZQUNuQixXQUFXLEVBQUUsQ0FBQztZQUNkLE9BQU87U0FDUjtRQUNELFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNoQjtBQUNILENBQUMsQ0FBQztBQUVGLE1BQU0sU0FBUyxHQUFHLENBQUMsR0FBVyxFQUFRLEVBQUU7SUFDdEMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7UUFDdkIsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEdBQUcsU0FBUyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZFLElBQUksV0FBVyxJQUFJLElBQUksRUFBRTtZQUN2QixXQUFXLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQztZQUM5QixXQUFXLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztZQUN0QyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDO1lBQ3RCLElBQUksRUFBRSxDQUFDO1lBQ1AsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNuQjtLQUNGO0FBQ0gsQ0FBQyxDQUFDO0FBRUYsTUFBTSxZQUFZLEdBQUcsR0FBUyxFQUFFO0lBQzlCLElBQUksSUFBSSxHQUFHLENBQUMsRUFBRTtRQUNaLElBQUksRUFBRSxDQUFDO1FBQ1AsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEdBQUcsU0FBUyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZFLElBQUksV0FBVyxJQUFJLElBQUksRUFBRTtZQUN2QixXQUFXLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztZQUM3QixXQUFXLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNyQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1NBQ3RCO0tBQ0Y7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLFdBQVcsR0FBRyxHQUFTLEVBQUU7SUFDN0IsSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFO1FBQ1osTUFBTSxVQUFVLEdBQVcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM5QyxtQkFBbUIsRUFBRSxDQUFDO1FBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLFVBQVUsNEJBQTRCLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDNUUsSUFBSSxVQUFVLEtBQUssTUFBTSxFQUFFO1lBQ3pCLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUMzQixRQUFRLEdBQUcsSUFBSSxDQUFDO1lBQ2hCLE9BQU87U0FDUjthQUFNO1lBQ0wsSUFBSSxHQUFHLElBQUksQ0FBQyxFQUFFO2dCQUNaLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDNUIsUUFBUSxHQUFHLElBQUksQ0FBQztnQkFDaEIsT0FBTzthQUNSO1lBQ0QsSUFBSSxHQUFHLEdBQUcsQ0FBQyxFQUFFO2dCQUNYLEdBQUcsRUFBRSxDQUFDO2dCQUNOLElBQUksR0FBRyxDQUFDLENBQUM7YUFDVjtTQUNGO0tBQ0Y7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLG1CQUFtQixHQUFHLEdBQVMsRUFBRTtJQUNyQyxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN4RCxJQUFJLFdBQVcsR0FBRyxNQUFNLENBQUM7SUFDekIsTUFBTSxVQUFVLEdBQWEsRUFBRSxDQUFDO0lBQ2hDLElBQUksU0FBUyxJQUFJLElBQUksRUFBRTtRQUNyQixNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQWtCLENBQUM7UUFDbkUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQWlCLEVBQUUsS0FBYSxFQUFFLEVBQUU7WUFDakQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzQyxJQUFJLFFBQVEsSUFBSSxJQUFJLEVBQUU7Z0JBQ3BCLFVBQVUsQ0FBQyxJQUFJLENBQ2I7b0JBQ0UsR0FBRyxFQUFFLFFBQVE7b0JBQ2IsS0FBSyxFQUFFLFlBQVk7aUJBQ3BCLENBQ0YsQ0FBQztnQkFDRixVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBYyxFQUFFLEtBQWEsRUFBRSxFQUFFO29CQUNuRCxJQUFJLE1BQU0sQ0FBQyxHQUFHLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFO3dCQUMvQixNQUFNLENBQUMsS0FBSyxHQUFHLGFBQWEsQ0FBQzt3QkFDN0IsV0FBVyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztxQkFDbkQ7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7Z0JBQ0gsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO29CQUM1QixJQUFJLFdBQVcsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFO3dCQUNwQyxNQUFNLENBQUMsS0FBSyxHQUFHLGNBQWMsQ0FBQzt3QkFDOUIsV0FBVyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztxQkFDbkQ7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7Z0JBQ0gsVUFBVSxDQUFDLEdBQVMsRUFBRTtvQkFDcEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMscUNBQXFDLENBQUMsQ0FBQztvQkFDMUQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUM1QyxjQUFjLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2pFLENBQUMsRUFBRSxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUM7YUFDakI7UUFDSCxDQUFDLENBQUMsQ0FBQztLQUNKO0FBQ0gsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgS0VZUywgUk9XUywgV09SRExFLCBmaWVsZCwga2V5Ym9hcmQgfSBmcm9tICcuL2NvbnN0LmpzJztcclxuaW1wb3J0IHsgTGV0dGVyIH0gZnJvbSAnLi90eXBlcy5qcyc7XHJcbmltcG9ydCB7IGtleWJvYXJkQ29sb3JzIH0gZnJvbSAnLi9rZXlib2FyZENvbG9ycy5qcyc7XHJcbmltcG9ydCB7IGRpc3BsYXlNZXNzYWdlIH0gZnJvbSAnLi9kaXNwbGF5TWVzc2FnZS5qcyc7XHJcblxyXG5sZXQgcm93ID0gMDtcclxubGV0IHRpbGUgPSAwO1xyXG5sZXQgZ2FtZU92ZXIgPSBmYWxzZTtcclxuXHJcblJPV1MuZm9yRWFjaCgocm93OiBzdHJpbmdbXSwgcm93SW5kZXg6IG51bWJlcikgPT4ge1xyXG4gIGNvbnN0IHJvd0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICByb3dFbGVtZW50LnNldEF0dHJpYnV0ZSgnaWQnLCBgcm93LSR7cm93SW5kZXh9YCk7XHJcbiAgcm93LmZvckVhY2goKHRpbGU6IHN0cmluZywgdGlsZUluZGV4OiBudW1iZXIpID0+IHtcclxuICAgIGNvbnN0IHRpbGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICB0aWxlRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2lkJywgYHJvdy0ke3Jvd0luZGV4fS10aWxlLSR7dGlsZUluZGV4fWApO1xyXG4gICAgdGlsZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZ2FtZS1jb250YWluZXJfX3RpbGUnKTtcclxuICAgIHJvd0VsZW1lbnQuYXBwZW5kKHRpbGVFbGVtZW50KTtcclxuICB9KTtcclxuICBpZiAoZmllbGQgIT0gbnVsbCkge1xyXG4gICAgZmllbGQuYXBwZW5kKHJvd0VsZW1lbnQpO1xyXG4gIH1cclxufSk7XHJcblxyXG5LRVlTLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XHJcbiAgYnV0dG9uLnRleHRDb250ZW50ID0ga2V5O1xyXG4gIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2lkJywga2V5KTtcclxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKTogdm9pZCA9PiBoYW5kbGVDbGljayhrZXkpKTtcclxuICBpZiAoa2V5Ym9hcmQgIT0gbnVsbCkge1xyXG4gICAga2V5Ym9hcmQuYXBwZW5kKGJ1dHRvbik7XHJcbiAgfVxyXG59KTtcclxuXHJcbmNvbnN0IGhhbmRsZUNsaWNrID0gKGtleTogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgaWYgKCFnYW1lT3Zlcikge1xyXG4gICAgaWYgKGtleSA9PT0gJ0RFTEVURScpIHtcclxuICAgICAgZGVsZXRlTGV0dGVyKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChrZXkgPT09ICdFTlRFUicpIHtcclxuICAgICAgY2hlY2tXb3JkbGUoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgYWRkTGV0dGVyKGtleSk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgYWRkTGV0dGVyID0gKGtleTogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgaWYgKHJvdyA8IDcgJiYgdGlsZSA8IDYpIHtcclxuICAgIGNvbnN0IGN1cnJlbnRUaWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJvdy0ke3Jvd30tdGlsZS0ke3RpbGV9YCk7XHJcbiAgICBpZiAoY3VycmVudFRpbGUgIT0gbnVsbCkge1xyXG4gICAgICBjdXJyZW50VGlsZS50ZXh0Q29udGVudCA9IGtleTtcclxuICAgICAgY3VycmVudFRpbGUuc2V0QXR0cmlidXRlKCdkYXRhJywga2V5KTtcclxuICAgICAgUk9XU1tyb3ddW3RpbGVdID0ga2V5O1xyXG4gICAgICB0aWxlKys7XHJcbiAgICAgIGNvbnNvbGUubG9nKFJPV1MpO1xyXG4gICAgfVxyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IGRlbGV0ZUxldHRlciA9ICgpOiB2b2lkID0+IHtcclxuICBpZiAodGlsZSA+IDApIHtcclxuICAgIHRpbGUtLTtcclxuICAgIGNvbnN0IGN1cnJlbnRUaWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJvdy0ke3Jvd30tdGlsZS0ke3RpbGV9YCk7XHJcbiAgICBpZiAoY3VycmVudFRpbGUgIT0gbnVsbCkge1xyXG4gICAgICBjdXJyZW50VGlsZS50ZXh0Q29udGVudCA9ICcnO1xyXG4gICAgICBjdXJyZW50VGlsZS5zZXRBdHRyaWJ1dGUoJ2RhdGEnLCAnJyk7XHJcbiAgICAgIFJPV1Nbcm93XVt0aWxlXSA9ICcnO1xyXG4gICAgfVxyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IGNoZWNrV29yZGxlID0gKCk6IHZvaWQgPT4ge1xyXG4gIGlmICh0aWxlID4gNSkge1xyXG4gICAgY29uc3QgdXNlcldvcmRsZTogc3RyaW5nID0gUk9XU1tyb3ddLmpvaW4oJycpO1xyXG4gICAgZmxpcENvbG9yc0FuaW1hdGlvbigpO1xyXG4gICAgY29uc29sZS5sb2coYFVzZXIgd29yZCBpcyAke3VzZXJXb3JkbGV9IGFuZCB0aGUgY29ycmVjdCB3b3JkIGlzICR7V09SRExFfWApO1xyXG4gICAgaWYgKHVzZXJXb3JkbGUgPT09IFdPUkRMRSkge1xyXG4gICAgICBkaXNwbGF5TWVzc2FnZSgnQ29ycmVjdCEnKTtcclxuICAgICAgZ2FtZU92ZXIgPSB0cnVlO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAocm93ID49IDYpIHtcclxuICAgICAgICBkaXNwbGF5TWVzc2FnZSgnR2FtZSBPdmVyJyk7XHJcbiAgICAgICAgZ2FtZU92ZXIgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBpZiAocm93IDwgNikge1xyXG4gICAgICAgIHJvdysrO1xyXG4gICAgICAgIHRpbGUgPSAwO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgZmxpcENvbG9yc0FuaW1hdGlvbiA9ICgpOiB2b2lkID0+IHtcclxuICBjb25zdCBwYXJlbnRSb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcm93LSR7cm93fWApO1xyXG4gIGxldCB3b3JkbGVDaGVjayA9IFdPUkRMRTtcclxuICBjb25zdCB1c2VyV29yZGxlOiBMZXR0ZXJbXSA9IFtdO1xyXG4gIGlmIChwYXJlbnRSb3cgIT0gbnVsbCkge1xyXG4gICAgY29uc3QgdGlsZXMgPSBPYmplY3QudmFsdWVzKHBhcmVudFJvdy5jaGlsZE5vZGVzKSBhcyBIVE1MRWxlbWVudFtdO1xyXG4gICAgdGlsZXMuZm9yRWFjaCgodGlsZTogSFRNTEVsZW1lbnQsIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgY29uc3QgdGlsZURhdGEgPSB0aWxlLmdldEF0dHJpYnV0ZSgnZGF0YScpO1xyXG4gICAgICBpZiAodGlsZURhdGEgIT0gbnVsbCkge1xyXG4gICAgICAgIHVzZXJXb3JkbGUucHVzaChcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAga2V5OiB0aWxlRGF0YSxcclxuICAgICAgICAgICAgY29sb3I6ICdjb2xvcl9ncmV5J1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdXNlcldvcmRsZS5mb3JFYWNoKChsZXR0ZXI6IExldHRlciwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgaWYgKGxldHRlci5rZXkgPT0gV09SRExFW2luZGV4XSkge1xyXG4gICAgICAgICAgICBsZXR0ZXIuY29sb3IgPSAnY29sb3JfZ3JlZW4nO1xyXG4gICAgICAgICAgICB3b3JkbGVDaGVjayA9IHdvcmRsZUNoZWNrLnJlcGxhY2UobGV0dGVyLmtleSwgJycpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHVzZXJXb3JkbGUuZm9yRWFjaCgobGV0dGVyKSA9PiB7XHJcbiAgICAgICAgICBpZiAod29yZGxlQ2hlY2suaW5jbHVkZXMobGV0dGVyLmtleSkpIHtcclxuICAgICAgICAgICAgbGV0dGVyLmNvbG9yID0gJ2NvbG9yX3llbGxvdyc7XHJcbiAgICAgICAgICAgIHdvcmRsZUNoZWNrID0gd29yZGxlQ2hlY2sucmVwbGFjZShsZXR0ZXIua2V5LCAnJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7IFxyXG4gICAgICAgIHNldFRpbWVvdXQoKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgdGlsZS5jbGFzc0xpc3QuYWRkKCdnYW1lLWNvbnRhaW5lcl9fdGlsZV9mbGlwLWFuaW1hdGlvbicpO1xyXG4gICAgICAgICAgdGlsZS5jbGFzc0xpc3QuYWRkKHVzZXJXb3JkbGVbaW5kZXhdLmNvbG9yKTtcclxuICAgICAgICAgIGtleWJvYXJkQ29sb3JzKHVzZXJXb3JkbGVbaW5kZXhdLmtleSwgdXNlcldvcmRsZVtpbmRleF0uY29sb3IpO1xyXG4gICAgICAgIH0sIDMwMCAqIGluZGV4KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59OyJdfQ==